<!DOCTYPE html><html lang="en"><head><title>controllers/group</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="controllers/group"><meta name="groc-project-path" content="controllers/group.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">controllers/group.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Define some pseudo module globals</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> isPro = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isPro;
<span class="hljs-keyword">var</span> isDev = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isDev;
<span class="hljs-keyword">var</span> isDbg = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isDbg;

<span class="hljs-keyword">var</span> async = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async'</span>);
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);

<span class="hljs-keyword">var</span> Group = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/group'</span>).Group;
<span class="hljs-keyword">var</span> Script = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/script'</span>).Script;

<span class="hljs-keyword">var</span> modelParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/modelParser'</span>);
<span class="hljs-keyword">var</span> modelQuery = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/modelQuery'</span>);
<span class="hljs-keyword">var</span> cleanFilename = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/helpers'</span>).cleanFilename;
<span class="hljs-keyword">var</span> getRating = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/collectiveRating'</span>).getRating;
<span class="hljs-keyword">var</span> execQueryTask = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/tasks'</span>).execQueryTask;
<span class="hljs-keyword">var</span> pageMetadata = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/templateHelpers'</span>).pageMetadata;
<span class="hljs-keyword">var</span> orderDir = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/templateHelpers'</span>).orderDir;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>clean the name of the group so it is url safe</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanGroupName</span><span class="hljs-params">(aName)</span> </span>{
  <span class="hljs-keyword">return</span> cleanFilename(aName, <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/_/g</span>, <span class="hljs-string">' '</span>)
    .replace(<span class="hljs-regexp">/^\s+|\s+$/g</span>, <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/,/g</span>, <span class="hljs-string">''</span>);
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>api for the client side javascript select2 library</p></div></div><div class="code"><div class="wrapper">exports.search = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aReq, aRes)</span> </span>{
  <span class="hljs-keyword">var</span> queryStr = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> queryRegex = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">var</span> addTerm = aReq.params.addTerm;
  <span class="hljs-keyword">var</span> term = cleanGroupName(aReq.params.term);
  <span class="hljs-keyword">var</span> terms = term.replace(<span class="hljs-regexp">/([.*+?^=!:${}()|\[\]\/\\])/g</span>, <span class="hljs-string">'\\$1'</span>).split(<span class="hljs-regexp">/\s+/</span>);
  <span class="hljs-keyword">var</span> results = <span class="hljs-literal">null</span>;

  aRes.set(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>);
  <span class="hljs-keyword">if</span> (terms.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> aRes.end(<span class="hljs-built_in">JSON</span>.stringify([]));
  }

  terms.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aTerm)</span> </span>{
    queryStr += <span class="hljs-string">'(?=.*?'</span> + aTerm + <span class="hljs-string">')'</span>;
  });
  queryRegex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(queryStr, <span class="hljs-string">'i'</span>);

  Group.find({ name: queryRegex }, <span class="hljs-string">'name'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aErr, aGroups)</span> </span>{
    <span class="hljs-keyword">if</span> (aErr) { aGroups = []; }

    results = aGroups.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aGroup)</span> </span>{
      <span class="hljs-keyword">return</span> aGroup.name;
    });

    <span class="hljs-keyword">if</span> (addTerm &amp;&amp; term.length &gt; <span class="hljs-number">0</span> &amp;&amp; results.indexOf(term) === -<span class="hljs-number">1</span>) {
      results.push(term);
    }

    aRes.end(<span class="hljs-built_in">JSON</span>.stringify(results));
  });
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>When the select2 library submits</p></div></div><div class="code"><div class="wrapper">exports.addScriptToGroups = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aScript, aGroupNames, aCallback)</span> </span>{
  <span class="hljs-keyword">if</span> (aScript.isLib || !aGroupNames || aGroupNames[<span class="hljs-number">0</span>].length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> aScript.save(aCallback);
  }

  Group.find({ name: { $<span class="hljs-keyword">in</span>: aGroupNames } }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aErr, aGroups)</span> </span>{
    <span class="hljs-keyword">var</span> existingGroups = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> existingNames = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> newGroup = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> tasks = [];

    <span class="hljs-keyword">if</span> (aErr || !aGroups) { aGroups = []; }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Groups to add the script to
This could have been added to the above query but
We need to figure out which groups don&#39;t exist as well (see below)</p></div></div><div class="code"><div class="wrapper">    existingGroups = aGroups.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aGroup)</span> </span>{
      <span class="hljs-keyword">return</span> aGroup._scriptIds.indexOf(aScript._id) === -<span class="hljs-number">1</span>;
    });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Names of existing groups</p></div></div><div class="code"><div class="wrapper">    existingNames = aGroups.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aGroup)</span> </span>{
      <span class="hljs-keyword">return</span> aGroup.name;
    });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Name of a group that doesn&#39;t exist</p></div></div><div class="code"><div class="wrapper">    newGroup = cleanGroupName(aGroupNames.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aName)</span> </span>{
      <span class="hljs-keyword">return</span> existingNames.indexOf(aName) === -<span class="hljs-number">1</span>;
    }).shift());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add script to exising groups</p></div></div><div class="code"><div class="wrapper">    tasks.push(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aCallback)</span> </span>{
      async.each(existingGroups, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aGroup, aInnerCallback)</span> </span>{
        aGroup._scriptIds.push(aScript._id);
        aGroup.update = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
        aGroup.save(aInnerCallback);
      }, aCallback);
    });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a custom group for the script</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (!aScript._groupId &amp;&amp; newGroup) {
      tasks.push(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aCallback)</span> </span>{
        <span class="hljs-keyword">var</span> group = <span class="hljs-keyword">new</span> Group({
          name: newGroup,
          rating: <span class="hljs-number">0</span>,
          updated: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
          _scriptIds: [aScript._id]
        });

        group.save(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aErr, aGroup)</span> </span>{
          aScript._groupId = aGroup._id;
          aCallback();
        });
      });
    }

    async.parallel(tasks, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      aScript.save(aCallback);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Update the groups in the background</p></div></div><div class="code"><div class="wrapper">      aGroups.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aGroup)</span> </span>{
        Script.find({ _id: { $<span class="hljs-keyword">in</span>: aGroup._scriptIds } },
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aErr, aScripts)</span> </span>{
            <span class="hljs-keyword">if</span> (aErr || aScripts.length &lt; <span class="hljs-number">2</span>) { <span class="hljs-keyword">return</span>; }

            aGroup.size = aScripts.length;
            aGroup.rating = getRating(aScripts);
            aGroup.updated = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
            aGroup.save(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ });
          }
        );
      });
    });
  });
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>list groups</p></div></div><div class="code"><div class="wrapper">exports.list = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aReq, aRes)</span> </span>{
  <span class="hljs-keyword">var</span> authedUser = aReq.session.user;

  <span class="hljs-keyword">var</span> options = {};
  <span class="hljs-keyword">var</span> tasks = [];

  <span class="hljs-comment">//---</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preRender</span><span class="hljs-params">()</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>groupList</p></div></div><div class="code"><div class="wrapper">    options.groupList = _.map(options.groupList, modelParser.parseGroup);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pagination</p></div></div><div class="code"><div class="wrapper">    options.paginationRendered = pagination.renderDefault(aReq);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupList</p></div></div><div class="code"><div class="wrapper">    options.popularGroupList = _.map(options.popularGroupList, modelParser.parseGroup);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Page metadata</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (options.groupList) {
      pageMetadata(options, <span class="hljs-string">'Groups'</span>, <span class="hljs-literal">null</span>, _.pluck(options.groupList, <span class="hljs-string">'name'</span>));
    }
  }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span><span class="hljs-params">()</span> </span>{ aRes.render(<span class="hljs-string">'pages/groupListPage'</span>, options); }
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncComplete</span><span class="hljs-params">()</span> </span>{ preRender(); render(); }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Session</p></div></div><div class="code"><div class="wrapper">  authedUser = options.authedUser = modelParser.parseUser(authedUser);
  options.isMod = authedUser &amp;&amp; authedUser.isMod;
  options.isAdmin = authedUser &amp;&amp; authedUser.isAdmin;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Page metadata</p></div></div><div class="code"><div class="wrapper">  pageMetadata(options, <span class="hljs-string">'Groups'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Order dir</p></div></div><div class="code"><div class="wrapper">  orderDir(aReq, options, <span class="hljs-string">'name'</span>, <span class="hljs-string">'asc'</span>);
  orderDir(aReq, options, <span class="hljs-string">'size'</span>, <span class="hljs-string">'desc'</span>);
  orderDir(aReq, options, <span class="hljs-string">'rating'</span>, <span class="hljs-string">'desc'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>groupListQuery</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> groupListQuery = Group.find();  <span class="hljs-comment">// TODO: STYLEGUIDE.md conformance needed here</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>groupListQuery: Defaults</p></div></div><div class="code"><div class="wrapper">  modelQuery.applyGroupListQueryDefaults(groupListQuery, options, aReq);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>groupListQuery: Pagination</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> pagination = options.pagination; <span class="hljs-comment">// is set in modelQuery.apply___ListQueryDefaults</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupListQuery</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> popularGroupListQuery = Group.find();
  popularGroupListQuery
    .sort(<span class="hljs-string">'-size'</span>)
    .limit(<span class="hljs-number">25</span>);

  <span class="hljs-comment">//--- Tasks</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pagination</p></div></div><div class="code"><div class="wrapper">  tasks.push(pagination.getCountTask(groupListQuery));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>groupListQuery</p></div></div><div class="code"><div class="wrapper">  tasks.push(execQueryTask(groupListQuery, options, <span class="hljs-string">'groupList'</span>));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupListQuery</p></div></div><div class="code"><div class="wrapper">  tasks.push(execQueryTask(popularGroupListQuery, options, <span class="hljs-string">'popularGroupList'</span>));

  <span class="hljs-comment">//---</span>
  async.parallel(tasks, asyncComplete);
};

<span class="hljs-keyword">var</span> setupGroupSidePanel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aOptions)</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Shortcuts</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> authedUser = aOptions.authedUser;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Mod</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (authedUser &amp;&amp; authedUser.isMod) {
    aOptions.modTools = {};
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Admin</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (authedUser &amp;&amp; authedUser.isAdmin) {
    aOptions.adminTools = {};
  }
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>list the scripts in a group</p></div></div><div class="code"><div class="wrapper">exports.view = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aReq, aRes, aNext)</span> </span>{
  <span class="hljs-keyword">var</span> authedUser = aReq.session.user;

  <span class="hljs-keyword">var</span> groupNameSlug = aReq.params.groupname;
  <span class="hljs-keyword">var</span> groupName = groupNameSlug.replace(<span class="hljs-regexp">/_+/g</span>, <span class="hljs-string">' '</span>);

  Group.findOne({
    name: groupName
  }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aErr, aGroupData)</span> </span>{
    <span class="hljs-keyword">if</span> (aErr || !aGroupData) { <span class="hljs-keyword">return</span> aNext(); }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Don&#39;t show page if we have no scripts assigned to it yet.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (aGroupData._scriptIds.length === <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span> aNext(); }

    <span class="hljs-keyword">var</span> options = {};
    <span class="hljs-keyword">var</span> tasks = [];

    <span class="hljs-comment">//---</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preRender</span><span class="hljs-params">()</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptList</p></div></div><div class="code"><div class="wrapper">      options.scriptList = _.map(options.scriptList, modelParser.parseScript);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupList</p></div></div><div class="code"><div class="wrapper">      options.popularGroupList = _.map(options.popularGroupList, modelParser.parseGroup);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pagination</p></div></div><div class="code"><div class="wrapper">      options.paginationRendered = pagination.renderDefault(aReq);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Empty list</p></div></div><div class="code"><div class="wrapper">      options.scriptListIsEmptyMessage = <span class="hljs-string">'No scripts.'</span>;
      <span class="hljs-keyword">if</span> (options.isFlagged) {
        <span class="hljs-keyword">if</span> (options.librariesOnly) {
          options.scriptListIsEmptyMessage = <span class="hljs-string">'No flagged libraries.'</span>;
        } <span class="hljs-keyword">else</span> {
          options.scriptListIsEmptyMessage = <span class="hljs-string">'No flagged scripts.'</span>;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.searchBarValue) {
        <span class="hljs-keyword">if</span> (options.librariesOnly) {
          options.scriptListIsEmptyMessage = <span class="hljs-string">'We couldn\'t find any libraries with this search value.'</span>;
        } <span class="hljs-keyword">else</span> {
          options.scriptListIsEmptyMessage = <span class="hljs-string">'We couldn\'t find any scripts with this search value.'</span>;
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.isUserScriptListPage) {
        options.scriptListIsEmptyMessage = <span class="hljs-string">'This user hasn\'t added any scripts yet.'</span>;
      }
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span><span class="hljs-params">()</span> </span>{ aRes.render(<span class="hljs-string">'pages/groupScriptListPage'</span>, options); }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncComplete</span><span class="hljs-params">()</span> </span>{ preRender(); render(); }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Session</p></div></div><div class="code"><div class="wrapper">    authedUser = options.authedUser = modelParser.parseUser(authedUser);
    options.isMod = authedUser &amp;&amp; authedUser.isMod;
    options.isAdmin = authedUser &amp;&amp; authedUser.isAdmin;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Page metadata</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> group = options.group = modelParser.parseGroup(aGroupData);
    pageMetadata(options, [group.name, <span class="hljs-string">'Groups'</span>]);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Order dir</p></div></div><div class="code"><div class="wrapper">    orderDir(aReq, options, <span class="hljs-string">'name'</span>, <span class="hljs-string">'asc'</span>);
    orderDir(aReq, options, <span class="hljs-string">'install'</span>, <span class="hljs-string">'desc'</span>);
    orderDir(aReq, options, <span class="hljs-string">'rating'</span>, <span class="hljs-string">'desc'</span>);
    orderDir(aReq, options, <span class="hljs-string">'updated'</span>, <span class="hljs-string">'desc'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> scriptListQuery = Script.find();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery: script in group</p></div></div><div class="code"><div class="wrapper">    scriptListQuery.find({ _id: { $<span class="hljs-keyword">in</span>: group._scriptIds } });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery: isLib=false</p></div></div><div class="code"><div class="wrapper">    scriptListQuery.find({ isLib: { $ne: <span class="hljs-literal">true</span> } });</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery: Defaults</p></div></div><div class="code"><div class="wrapper">    modelQuery.applyScriptListQueryDefaults(scriptListQuery, options, aReq);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery: Pagination</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> pagination = options.pagination; <span class="hljs-comment">// is set in modelQuery.apply___ListQueryDefaults</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupListQuery</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> popularGroupListQuery = Group.find();
    popularGroupListQuery
      .sort(<span class="hljs-string">'-size'</span>)
      .limit(<span class="hljs-number">25</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>SideBar</p></div></div><div class="code"><div class="wrapper">    setupGroupSidePanel(options);

    <span class="hljs-comment">//--- Tasks</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pagination</p></div></div><div class="code"><div class="wrapper">    tasks.push(pagination.getCountTask(scriptListQuery));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>scriptListQuery</p></div></div><div class="code"><div class="wrapper">    tasks.push(execQueryTask(scriptListQuery, options, <span class="hljs-string">'scriptList'</span>));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>popularGroupListQuery</p></div></div><div class="code"><div class="wrapper">    tasks.push(execQueryTask(popularGroupListQuery, options, <span class="hljs-string">'popularGroupList'</span>));

    <span class="hljs-comment">//---</span>
    async.parallel(tasks, asyncComplete);
  });
};</div></div></div></div></body></html>