<!DOCTYPE html><html lang="en"><head><title>libs/helpers</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="libs/helpers"><meta name="groc-project-path" content="libs/helpers.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">libs/helpers.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Define some pseudo module globals</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> isPro = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isPro;
<span class="hljs-keyword">var</span> isDev = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isDev;
<span class="hljs-keyword">var</span> isDbg = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/debug'</span>).isDbg;

<span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">"url"</span>);
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);

<span class="hljs-keyword">var</span> months = [
  <span class="hljs-string">'Jan'</span>,
  <span class="hljs-string">'Feb'</span>,
  <span class="hljs-string">'Mar'</span>,
  <span class="hljs-string">'Apr'</span>,
  <span class="hljs-string">'May'</span>,
  <span class="hljs-string">'Jun'</span>,
  <span class="hljs-string">'Jul'</span>,
  <span class="hljs-string">'Aug'</span>,
  <span class="hljs-string">'Sep'</span>,
  <span class="hljs-string">'Oct'</span>,
  <span class="hljs-string">'Nov'</span>,
  <span class="hljs-string">'Dec'</span>
];
<span class="hljs-keyword">var</span> second = <span class="hljs-number">1000</span>;
<span class="hljs-keyword">var</span> minute = second * <span class="hljs-number">60</span>;
<span class="hljs-keyword">var</span> hour = minute * <span class="hljs-number">60</span>;
<span class="hljs-keyword">var</span> day = hour * <span class="hljs-number">24</span>;
<span class="hljs-keyword">var</span> week = day * <span class="hljs-number">7</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get a formatted date that can be used everywhere a date is displayed</p></div></div><div class="code"><div class="wrapper">exports.formatDate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aDate)</span> </span>{
  <span class="hljs-keyword">var</span> difference = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - aDate.getTime();
  <span class="hljs-keyword">var</span> ret = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> days = <span class="hljs-number">0</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pluralize</span><span class="hljs-params">(aNumber, aUnit)</span> </span>{
    <span class="hljs-keyword">return</span> aNumber + <span class="hljs-string">' '</span> + aUnit + (aNumber &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">'s'</span> : <span class="hljs-string">''</span>) + <span class="hljs-string">' ago'</span>;
  }

  <span class="hljs-keyword">if</span> (difference &gt; week) {
    ret = aDate.getDate() + <span class="hljs-string">' '</span>
      + months[aDate.getMonth()] + <span class="hljs-string">' '</span>
      + aDate.getFullYear();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (difference &gt; day) {
    days = <span class="hljs-built_in">Math</span>.round(difference / day);
    <span class="hljs-keyword">if</span> (days &lt;= <span class="hljs-number">1</span>) {
      ret = <span class="hljs-string">'Yesterday'</span>;
    } <span class="hljs-keyword">else</span> {
      ret = days + <span class="hljs-string">' days ago'</span>;
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (difference &gt; hour) {
    ret = pluralize(<span class="hljs-built_in">Math</span>.round(difference / hour), <span class="hljs-string">'hour'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (difference &gt; minute) {
    ret = pluralize(<span class="hljs-built_in">Math</span>.round(difference / minute), <span class="hljs-string">'minute'</span>);
  } <span class="hljs-keyword">else</span> {
    ret = pluralize(<span class="hljs-built_in">Math</span>.ceil(difference / second), <span class="hljs-string">'second'</span>);
  }

  <span class="hljs-keyword">return</span> ret;
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create an object with no properties</p></div></div><div class="code"><div class="wrapper">exports.nil = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aObj)</span> </span>{
  <span class="hljs-keyword">var</span> nilObj = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">if</span> (!aObj) <span class="hljs-keyword">return</span> nilObj;

  exports.forIn(aObj, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aVal, aKey)</span> </span>{
    nilObj[aKey] = aVal;
  });

  <span class="hljs-keyword">return</span> nilObj;
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Safely iterate on an object not create using nil()</p></div></div><div class="code"><div class="wrapper">exports.forIn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aObj, aForProp)</span> </span>{
  <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> aObj) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(aObj, key)) { <span class="hljs-keyword">continue</span>; }
    aForProp(aObj[key], key, aObj);
  }
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Clean filenames but leave them readable
Based on Greasemonkey modules/remoteScript.js</p></div></div><div class="code"><div class="wrapper">exports.cleanFilename = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aFilename, aDefaultName)</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Blacklist problem characters (slashes, colons, etc.).</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> cleanName = (aFilename || <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/[\\\/:*?\'\"&lt;&gt;|#;@=&amp;]/g</span>, <span class="hljs-string">''</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Make whitespace readable.</p></div></div><div class="code"><div class="wrapper">  .replace(<span class="hljs-regexp">/(\s|%20)+/g</span>, <span class="hljs-string">'_'</span>);

  <span class="hljs-keyword">return</span> cleanName || aDefaultName;
};

exports.limitRange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aMin, aX, aMax)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.min(aX, aMax), aMin);
};

exports.limitMin = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aMin, aX)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.max(aX, aMin);
};

<span class="hljs-keyword">var</span> setUrlQueryValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aBaseUrl, aQueryVarKey, aQueryVarValue)</span> </span>{
  <span class="hljs-keyword">var</span> parseQueryString = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">var</span> u = url.parse(aBaseUrl, parseQueryString);
  u.query[aQueryVarKey] = aQueryVarValue;
  <span class="hljs-keyword">delete</span> u.search; <span class="hljs-comment">// http://stackoverflow.com/a/7517673/947742</span>
  <span class="hljs-keyword">return</span> url.format(u);
};
exports.setUrlQueryValue = setUrlQueryValue;

exports.updateUrlQueryString = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aBaseUrl, aDict)</span> </span>{
  <span class="hljs-keyword">var</span> url = aBaseUrl;
  _.each(aDict, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(aValue, aKey)</span> </span>{
    url = setUrlQueryValue(url, aKey, aValue);
  });
  <span class="hljs-keyword">return</span> url;
};</div></div></div></div></body></html>